<!DOCTYPE html>
<html lang="en">

<head>
    {{ template "head.html" }}
</head>

<body class="min-h-screen bg-gray-50 p-4" data-page="timeline">
    <!-- Navbar -->
    {{template "nav.html" .}}

    <main class="w-full max-w-screen-lg mx-auto space-y-6 bg-white shadow rounded-xl p-6">
        <h1 class="text-2xl font-semibold text-center">Weather Trends</h1>

        <div class="space-y-3">
            <p class="text-sm text-gray-700 leading-relaxed p-2 bg-[#eaf2fa] border border-[#d1e6f5] rounded-lg">
                This page displays the long-term climatic development based on
                <a class="text-blue-600 hover:underline"
                    href="https://opendatadocs.meteoswiss.ch/c-climate-data/c1-climate-stations_homogeneous"
                    target="_blank">
                    homogenous data
                </a>
                from MeteoSwiss's climate stations.
            </p>
        </div>

        <div class="space-y-3">
            <!-- Search (locations or postal codes) -->
            <div class="grid grid-cols-3 gap-3 items-start">
                <label for="station-search" class="col-span-1 font-medium pt-2">Search</label>

                <div class="col-span-2">
                    <div class="flex items-center gap-2">
                        <input id="station-search" name="q" type="search" placeholder="'3004' or 'Bern'"
                            class="border rounded p-2 w-full" autocomplete="off" spellcheck="false"
                            hx-get="/stations/search?station_type=climate"
                            hx-trigger="input changed delay:400ms, search" hx-target="#search-results" />
                    </div>
                    <div id="search-results"></div>
                </div>
            </div>

            <!-- Controls -->
            <form class="space-y-3" id="chart-controls">

                <!-- Station -->
                <div class="grid grid-cols-3 gap-3 items-start">
                    <label for="station" class="col-span-1 font-medium pt-2">Station</label>

                    <select id="station" name="station" class="col-span-2 border rounded p-2 w-full">
                        {{$selected := .Query.station}}
                        {{range .Stations}}
                        <option value="{{.Abbr}}" {{if eq .Abbr $selected}}selected{{end}}>{{.Name}} {{.Canton}}
                            ({{.Abbr}})
                        </option>
                        {{end}}
                    </select>
                </div>

                <!-- Period -->
                <div class="grid grid-cols-3 gap-3 items-start">
                    <label for="period" class="col-span-1 font-medium pt-2">Period</label>

                    <select id="period" name="period" class="col-span-2 border rounded p-2 w-full">
                        <!-- Jan Feb Mar ... Spring Summer etc.-->
                        {{range .Periods}}
                        <option value="{{.Value}}" {{.Selected}}>{{.DisplayName}}</option>
                        {{end}}
                    </select>
                </div>

                <!-- Year Range -->
                <div class="grid grid-cols-3 gap-3 items-start">
                    <label for="from_year" class="col-span-1 font-medium pt-2">Year Range</label>
                    <div class="col-span-2 grid grid-cols-2 gap-3">
                        <input type="number" id="from_year" name="from_year" placeholder="From"
                            value="{{.Query.from_year}}" class="border rounded p-2 w-full">
                        <input type="number" id="to_year" name="to_year" placeholder="To" value="{{.Query.to_year}}"
                            class="border rounded p-2 w-full">
                    </div>
                </div>

                <!-- Smoothing Window -->
                <div class="grid grid-cols-3 gap-3 items-start">
                    <label class="col-span-1 font-medium pt-2">Smoothing</label>
                    <div class="col-span-2 flex items-center space-x-4">
                        <label class="inline-flex items-center border rounded p-2 w-full">
                            <input type="radio" name="window" value="1" class="form-radio" {{if ne .Query.window "5"
                                }}checked{{end}}>
                            <span class="ml-2">Annual</span>
                        </label>
                        <label class="inline-flex items-center border rounded p-2 w-full">
                            <input type="radio" name="window" value="5" class="form-radio" {{if eq .Query.window "5"
                                }}checked{{end}}>
                            <span class="ml-2">5-year rolling avg.</span>
                        </label>
                    </div>
                </div>
            </form>

        </div>
        <!-- Summary -->
        <div>
            <div id="station-summary-container" hx-ext="path-params" hx-trigger="change from:#chart-controls"
                hx-get="/stations/{station}/summary" hx-include="#chart-controls" hx-target="this" hx-swap="innerHTML">
                <!-- station summary goes here -->
            </div>
        </div>

        <!-- Charts -->
        <div>
            <h2 class="text-lg font-medium text-gray-800 mt-6 mb-2">Average Temperature</h2>
            <p class="text-sm text-gray-600 leading-relaxed mb-4">
                Average temperatures for each year during the selected period
                (e.g. a specific month or season), highlighting how absolute values have evolved over time.
                The three lines shown represent average daily min/mean/max temperatures, respectively.
            </p>
            <div class="mb-8">
                <div hx-ext="path-params" hx-trigger="change from:#chart-controls"
                    hx-get="/stations/{station}/charts/trends/temperature" hx-include="#chart-controls" hx-target="this"
                    hx-swap="innerHTML" data-vega-target="temperature-chart">
                    <!-- Vega script goes here -->
                </div>
                <div id="temperature-chart" class="w-full overflow-hidden"></div>
            </div>

            <h2 class="text-lg font-medium text-gray-800 mt-6 mb-2">Temperature Deviations</h2>
            <p class="text-sm text-gray-600 leading-relaxed mb-4">
                Yearly deviations from the long-term mean of the <strong>average daily mean temperatures</strong>
                for the entire period. Red bars indicate years warmer than this overall mean, while blue bars show
                cooler years.
            </p>
            <div class="mb-8">
                <div hx-ext="path-params" hx-trigger="change from:#chart-controls"
                    hx-get="/stations/{station}/charts/trends/temperature_deviation" hx-include="#chart-controls"
                    hx-target="this" hx-swap="innerHTML" data-vega-target="temperature-deviation-chart">
                    <!-- Vega script goes here -->
                </div>
                <div id="temperature-deviation-chart" class="w-full overflow-hidden"></div>
            </div>

            <h2 class="text-lg font-medium text-gray-800 mt-6 mb-2">Total Precipitation</h2>
            <p class="text-sm text-gray-600 leading-relaxed mb-4">
                Total precipitation (in millimeters) for the selected period each year,
                illustrating changes in rainfall over time.
            </p>
            <div class="mb-8">
                <div hx-ext="path-params" hx-trigger="change from:#chart-controls"
                    hx-get="/stations/{station}/charts/trends/precipitation" hx-include="#chart-controls"
                    hx-target="this" hx-swap="innerHTML" data-vega-target="precipitation-chart">
                    <!-- Vega script goes here -->
                </div>
                <div id="precipitation-chart" class="w-full overflow-hidden"></div>
            </div>

            <!-- Summer/Frost days tabs -->
            <h2 class="text-lg font-medium text-gray-800 mt-6 mb-2">Special Temperature Days</h2>
            <p class="text-sm text-gray-600 leading-relaxed mb-4">
                Number of days for the selected period each year: 
                <em>ice days</em> (max. temperature &lt; 0 °C), 
                <em>frost days</em> (min. temperature &lt; 0 °C), 
                <em>summer days</em> (max. temperature ≥ 25 °C),
                <em>heat days</em> (max. temperature ≥ 30 °C),
                and 
                <em>tropical nights</em> (max. temperature ≥ 20 °C).
            </p>
            <div class="tab-widget mb-12">
                <div role="tablist" class="flex gap-2 mb-4 border-b border-gray-200">
                    <button data-chart-type="ice_days" role="tab" aria-selected="false" class="px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-600
                   hover:text-gray-800 focus:outline-none
                   aria-selected:border-blue-600 aria-selected:text-blue-600">
                        Ice days
                    </button>
                    <button data-chart-type="frost_days" role="tab" aria-selected="false" class="px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-600
                   hover:text-gray-800 focus:outline-none
                   aria-selected:border-blue-600 aria-selected:text-blue-600">
                        Frost days
                    </button>
                    <button data-chart-type="summer_days" role="tab" aria-selected="true" class="px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-600
                   hover:text-gray-800 focus:outline-none
                   aria-selected:border-blue-600 aria-selected:text-blue-600">
                        Summer days
                    </button>
                    <button data-chart-type="heat_days" role="tab" aria-selected="false" class="px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-600
                   hover:text-gray-800 focus:outline-none
                   aria-selected:border-blue-600 aria-selected:text-blue-600">
                        Heat days
                    </button>
                    <button data-chart-type="tropical_nights" role="tab" aria-selected="false" class="px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-600
                   hover:text-gray-800 focus:outline-none
                   aria-selected:border-blue-600 aria-selected:text-blue-600">
                        Tropical nights
                    </button>
                </div>

                <div class="vega-spec-loader" data-vega-target="seasondays-vega-chart"
                    hx-get="/stations/{station}/charts/trends/{chartType}" hx-ext="path-params"
                    hx-trigger="change from:#chart-controls, refresh" hx-include="#chart-controls"
                    hx-vals='{"chartType":"summer_days"}' hx-target="this" hx-swap="innerHTML"></div>
                <div id="seasondays-vega-chart" class="w-full overflow-hidden"></div>
            </div>


        </div>

    </main>

    <footer>
        {{template "disclaimer.html" .}}
    </footer>


    <script type="module" src='{{assetHash "/static/dist/main.js"}}'></script>

</body>

</html>